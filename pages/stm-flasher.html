<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>STM Flasher | Ar3s</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/assets/styles.css">
  <link rel="stylesheet" href="/assets/flasher.css">
</head>
<body>
  <header class="header">
    <div class="brand">Ar3s</div>
    <nav>
      <a href="/index.html">Home</a>
      <a href="/pages/ide.html">Ar3s IDE v2</a>
      <a href="/pages/simulator.html">Simulator</a>
      <a href="/pages/esp-custom.html">ESP Custom Flasher</a>
    </nav>
  </header>

  <main class="container">
    <div class="page-header">
      <h1 class="page-title">
        <span class="title-accent">//</span> STM FLASHER
      </h1>
      <p class="page-description">Flash STM32 boards via WebUSB using DFU bootloader. Requires HTTPS (ar3s-compiler.duckdns.org) and Chrome/Edge.</p>
    </div>

    <div class="panel flasher-panel">
      <div class="control-group">
        <div class="control-item">
          <label for="protocol" class="control-label">Protocol</label>
          <select id="protocol" class="board-select">
            <option value="webusb" selected>WebUSB (DFU)</option>
            <option value="webserial">WebSerial</option>
          </select>
          <small class="muted control-hint">DFU requires bootloader mode</small>
        </div>
        
        <div class="control-item">
          <label for="address" class="control-label">Flash Address (hex)</label>
          <input id="address" type="text" value="0x08000000" class="control-input">
          <small class="muted control-hint">Default: 0x08000000</small>
        </div>
        
        <div class="control-item">
          <label for="binfile" class="control-label">Firmware (.bin)</label>
          <input id="binfile" type="file" accept=".bin" class="file-input">
        </div>
      </div>

      <div class="button-group">
        <button id="connectBtn" class="btn">
          <span class="btn-icon">ðŸ”Œ</span>
          Connect Device
        </button>
        <button id="flashBtn" class="btn" disabled>
          <span class="btn-icon">âš¡</span>
          Flash Firmware
        </button>
      </div>

      <div class="status-console">
        <div class="console-header">
          <span class="console-title">[ SYSTEM STATUS ]</span>
          <div class="console-indicators">
            <span class="indicator" id="systemIndicator"></span>
          </div>
        </div>
        <div id="statusLog" class="console-content"></div>
      </div>
    </div>

    <div class="panel">
      <h3 style="margin-top: 0; color: var(--accent);">Instructions</h3>
      <ol style="color: var(--muted); line-height: 1.8;">
        <li>Put your STM32 board into DFU bootloader mode (usually BOOT0=1, then reset)</li>
        <li>Select the protocol (WebUSB for DFU is recommended)</li>
        <li>Choose your firmware .bin file</li>
        <li>Click "Connect Device" and select your STM32 board from the browser dialog</li>
        <li>Click "Flash Firmware" to begin the flashing process</li>
        <li>Wait for completion and reset your board (BOOT0=0)</li>
      </ol>
      <p style="color: var(--muted); font-size: 0.9rem;">
        <strong>Note:</strong> This flasher supports STM32 devices with DFU bootloader. 
        For other flashing methods, use external tools like STM32CubeProgrammer.
      </p>
    </div>
  </main>

  <script type="module" src="/assets/stm-flasher.js"></script>
</body>
</html>
